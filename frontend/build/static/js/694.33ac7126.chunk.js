"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[694],{694:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var i=s(424),a=s(474),r=s(269),n=s(555),l=s(722),o=s(579);const c=e=>{let{user:t,language:s,isRTL:c,onClose:d,onSave:x}=e;const[m,g]=(0,i.useState)({clinic_id:"",visit_date:(new Date).toISOString().split("T")[0],visit_time:(new Date).toTimeString().split(" ")[0].substring(0,5),managers:[],visit_effectiveness:"",order_status:"",visit_notes:"",products_discussed:[],samples_given:[],next_visit_date:""}),[u,h]=(0,i.useState)([]),[p,v]=(0,i.useState)([]),[f,b]=(0,i.useState)([]),[w,j]=(0,i.useState)(null),[_,y]=(0,i.useState)(!1),[N,S]=(0,i.useState)(!1),{t:k}=(0,a.Bd)(s),A="https://6fc37004-de78-473a-b926-f0438820a235.preview.emergentagent.com/api";(0,i.useEffect)((()=>{P(),E(),I(),C()}),[]);const C=()=>{y(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{j({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,timestamp:(new Date).toISOString()}),console.log("\u2705 Location obtained for visit:",e.coords),y(!1)}),(e=>{console.error("\u274c Location error:",e),alert("\u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062d\u0635\u0648\u0644 \u0639\u0644\u0649 \u0627\u0644\u0645\u0648\u0642\u0639 \u0627\u0644\u062d\u0627\u0644\u064a. \u0627\u0644\u0645\u0648\u0642\u0639 \u0645\u0637\u0644\u0648\u0628 \u0644\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0629."),y(!1)}),{enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4}):(alert("\u0627\u0644\u0645\u062a\u0635\u0641\u062d \u0644\u0627 \u064a\u062f\u0639\u0645 \u062e\u062f\u0645\u0627\u062a \u0627\u0644\u0645\u0648\u0642\u0639"),y(!1))},P=async()=>{try{const e=localStorage.getItem("access_token"),t=await l.A.get("".concat(A,"/clinics"),{headers:{Authorization:"Bearer ".concat(e)}});h(t.data||[])}catch(e){console.error("Error fetching clinics:",e),h([{id:"clinic-001",name:"\u0639\u064a\u0627\u062f\u0629 \u0627\u0644\u062f\u0643\u062a\u0648\u0631 \u0623\u062d\u0645\u062f \u0645\u062d\u0645\u062f",doctor_name:"\u062f. \u0623\u062d\u0645\u062f \u0645\u062d\u0645\u062f \u0639\u0644\u064a",specialization:"\u0628\u0627\u0637\u0646\u0629 \u0639\u0627\u0645\u0629",classification:"A",address:"\u0634\u0627\u0631\u0639 \u0627\u0644\u062c\u0645\u0647\u0648\u0631\u064a\u0629\u060c \u0627\u0644\u0645\u0646\u0635\u0648\u0631\u0629"},{id:"clinic-002",name:"\u0645\u0631\u0643\u0632 \u0627\u0644\u0646\u064a\u0644 \u0627\u0644\u0637\u0628\u064a",doctor_name:"\u062f. \u0641\u0627\u0637\u0645\u0629 \u0633\u0639\u062f",specialization:"\u0623\u0645\u0631\u0627\u0636 \u0642\u0644\u0628",classification:"B",address:"\u0634\u0627\u0631\u0639 \u0627\u0644\u0646\u064a\u0644\u060c \u0627\u0644\u0642\u0627\u0647\u0631\u0629"}])}},E=async()=>{try{const e=localStorage.getItem("access_token"),t=await l.A.get("".concat(A,"/users?role=manager,district_manager,gm"),{headers:{Authorization:"Bearer ".concat(e)}});v(t.data||[])}catch(e){console.error("Error fetching managers:",e),v([{id:"mgr-001",full_name:"\u0623\u062d\u0645\u062f \u0627\u0644\u0645\u062f\u064a\u0631",role:"district_manager"},{id:"mgr-002",full_name:"\u0633\u0627\u0631\u0629 \u0645\u062f\u064a\u0631\u0629 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a",role:"manager"}])}},I=async()=>{try{const e=localStorage.getItem("access_token"),t=await l.A.get("".concat(A,"/products"),{headers:{Authorization:"Bearer ".concat(e)}});b(t.data||[])}catch(e){console.error("Error fetching products:",e),b([{id:"prod-001",name:"\u0623\u0645\u0648\u0643\u0633\u064a\u0633\u064a\u0644\u064a\u0646 500mg",unit:"\u06a4\u0627\u064a\u0644"},{id:"prod-002",name:"\u0641\u064a\u062a\u0627\u0645\u064a\u0646 \u062f3",unit:"\u0639\u0644\u0628\u0629"}])}},L=(e,t)=>{g((s=>(0,n.A)((0,n.A)({},s),{},{[e]:t})))};return(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,o.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-white/20",children:(0,o.jsxs)("div",{className:"p-6",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center",children:(0,o.jsx)("span",{className:"text-2xl text-white",children:"\ud83c\udfe5"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{className:"text-2xl font-bold text-white",children:"\u062a\u0633\u062c\u064a\u0644 \u0632\u064a\u0627\u0631\u0629 \u062c\u062f\u064a\u062f\u0629"}),(0,o.jsx)("p",{className:"text-sm text-white/70",children:"\u062a\u0633\u062c\u064a\u0644 \u0632\u064a\u0627\u0631\u0629 \u0644\u0644\u0639\u064a\u0627\u062f\u0629 \u0645\u0639 \u062a\u062a\u0628\u0639 \u0627\u0644\u0645\u0648\u0642\u0639"})]})]}),(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg ".concat(w?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"),children:[(0,o.jsx)("span",{children:_?"\u23f3":w?"\ud83d\udccd":"\u274c"}),(0,o.jsx)("span",{className:"text-xs",children:_?"\u062c\u0627\u0631\u064a \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0645\u0648\u0642\u0639...":w?"\u062a\u0645 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0645\u0648\u0642\u0639":"\u0641\u0634\u0644 \u0641\u064a \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0645\u0648\u0642\u0639"})]}),(0,o.jsx)("button",{onClick:d,className:"text-white/70 hover:text-white text-2xl",children:"\u2715"})]})]}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!w)return alert("\u064a\u062c\u0628 \u0627\u0644\u062d\u0635\u0648\u0644 \u0639\u0644\u0649 \u0627\u0644\u0645\u0648\u0642\u0639 \u0627\u0644\u062d\u0627\u0644\u064a \u0642\u0628\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0629"),void C();if(m.clinic_id)if(0!==m.managers.length){S(!0);try{var s;const e=(0,n.A)((0,n.A)({},m),{},{medical_rep_id:t.id,medical_rep_name:t.full_name,location:w,visit_datetime:"".concat(m.visit_date,"T").concat(m.visit_time,":00.000Z"),created_at:(new Date).toISOString(),status:"completed"}),i=localStorage.getItem("access_token"),a=await l.A.post("".concat(A,"/visits"),e,{headers:{Authorization:"Bearer ".concat(i)}});await r.a.logVisit(a.data.id,m.clinic_id,{clinic_name:null===(s=u.find((e=>e.id===m.clinic_id)))||void 0===s?void 0:s.name,visit_effectiveness:m.visit_effectiveness,order_status:m.order_status,managers_notified:m.managers,products_discussed:m.products_discussed,location:w,rep_name:t.full_name,rep_role:t.role}),alert("\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0629 \u0628\u0646\u062c\u0627\u062d"),x&&x(a.data),d()}catch(i){console.error("Error creating visit:",i),alert("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0629")}finally{S(!1)}}else alert("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0645\u062f\u064a\u0631 \u0648\u0627\u062d\u062f \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644");else alert("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0639\u064a\u0627\u062f\u0629")},className:"space-y-6",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"\u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u0639\u064a\u0627\u062f\u0629 *"}),(0,o.jsxs)("select",{value:m.clinic_id,onChange:e=>L("clinic_id",e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white",required:!0,children:[(0,o.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0639\u064a\u0627\u062f\u0629"}),u.map((e=>(0,o.jsxs)("option",{value:e.id,className:"text-black",children:[e.name," - ",e.doctor_name]},e.id)))]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0632\u064a\u0627\u0631\u0629 *"}),(0,o.jsx)("input",{type:"date",value:m.visit_date,onChange:e=>L("visit_date",e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"\u0648\u0642\u062a \u0627\u0644\u0632\u064a\u0627\u0631\u0629 *"}),(0,o.jsx)("input",{type:"time",value:m.visit_time,onChange:e=>L("visit_time",e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"\u0641\u0639\u0627\u0644\u064a\u0629 \u0627\u0644\u0632\u064a\u0627\u0631\u0629 *"}),(0,o.jsxs)("select",{value:m.visit_effectiveness,onChange:e=>L("visit_effectiveness",e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white",required:!0,children:[(0,o.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0641\u0639\u0627\u0644\u064a\u0629 \u0627\u0644\u0632\u064a\u0627\u0631\u0629"}),(0,o.jsx)("option",{value:"excellent",className:"text-black",children:"\u0645\u0645\u062a\u0627\u0632\u0629"}),(0,o.jsx)("option",{value:"very_good",className:"text-black",children:"\u062c\u064a\u062f\u0629 \u062c\u062f\u0627\u064b"}),(0,o.jsx)("option",{value:"good",className:"text-black",children:"\u062c\u064a\u062f\u0629"}),(0,o.jsx)("option",{value:"average",className:"text-black",children:"\u0645\u062a\u0648\u0633\u0637\u0629"}),(0,o.jsx)("option",{value:"poor",className:"text-black",children:"\u0636\u0639\u064a\u0641\u0629"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0637\u0644\u0628 *"}),(0,o.jsxs)("select",{value:m.order_status,onChange:e=>L("order_status",e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white",required:!0,children:[(0,o.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u0637\u0644\u0628"}),(0,o.jsx)("option",{value:"ordered",className:"text-black",children:"\u062a\u0645 \u0627\u0644\u0637\u0644\u0628"}),(0,o.jsx)("option",{value:"interested",className:"text-black",children:"\u0645\u0647\u062a\u0645"}),(0,o.jsx)("option",{value:"considering",className:"text-black",children:"\u062a\u062d\u062a \u0627\u0644\u062f\u0631\u0627\u0633\u0629"}),(0,o.jsx)("option",{value:"no_order",className:"text-black",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0637\u0644\u0628"}),(0,o.jsx)("option",{value:"follow_up",className:"text-black",children:"\u0645\u062a\u0627\u0628\u0639\u0629 \u0644\u0627\u062d\u0642\u0629"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0632\u064a\u0627\u0631\u0629 \u0627\u0644\u0642\u0627\u062f\u0645\u0629"}),(0,o.jsx)("input",{type:"date",value:m.next_visit_date,onChange:e=>L("next_visit_date",e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-3",children:"\u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u0645\u062f\u0631\u0627\u0621 \u0644\u0644\u0625\u0634\u0639\u0627\u0631 * (\u0645\u062a\u0639\u062f\u062f)"}),(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:p.map((e=>(0,o.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:bg-white/10 transition-colors",children:[(0,o.jsx)("input",{type:"checkbox",checked:m.managers.includes(e.id),onChange:()=>{return t=e.id,void g((e=>(0,n.A)((0,n.A)({},e),{},{managers:e.managers.includes(t)?e.managers.filter((e=>e!==t)):[...e.managers,t]})));var t},className:"w-5 h-5 text-green-600 rounded border-2 border-white/30"}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("div",{className:"text-white font-medium",children:e.full_name}),(0,o.jsx)("div",{className:"text-white/60 text-xs",children:e.role})]})]},e.id)))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-3",children:"\u0627\u0644\u0645\u0646\u062a\u062c\u0627\u062a \u0627\u0644\u062a\u064a \u062a\u0645 \u0645\u0646\u0627\u0642\u0634\u062a\u0647\u0627"}),(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-32 overflow-y-auto",children:f.map((e=>(0,o.jsxs)("label",{className:"flex items-center gap-3 p-2 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:bg-white/10 transition-colors",children:[(0,o.jsx)("input",{type:"checkbox",checked:m.products_discussed.includes(e.id),onChange:()=>{return t=e.id,void g((e=>(0,n.A)((0,n.A)({},e),{},{products_discussed:e.products_discussed.includes(t)?e.products_discussed.filter((e=>e!==t)):[...e.products_discussed,t]})));var t},className:"w-4 h-4 text-green-600 rounded border-2 border-white/30"}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("div",{className:"text-white text-sm",children:e.name}),(0,o.jsx)("div",{className:"text-white/60 text-xs",children:e.unit})]})]},e.id)))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a \u0627\u0644\u0632\u064a\u0627\u0631\u0629"}),(0,o.jsx)("textarea",{value:m.visit_notes,onChange:e=>L("visit_notes",e.target.value),rows:"4",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white resize-none",placeholder:"\u0623\u0636\u0641 \u0645\u0644\u0627\u062d\u0638\u0627\u062a \u062d\u0648\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0629..."})]}),(0,o.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,o.jsx)("button",{type:"submit",disabled:N||!w,className:"flex-1 bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-300 font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white/30 border-t-white"}),"\u062c\u0627\u0631\u064a \u0627\u0644\u062d\u0641\u0638..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{children:"\ud83d\udcbe"}),"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0629"]})}),(0,o.jsx)("button",{type:"button",onClick:d,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]})})})},d=e=>{let{visits:t,loading:s,onVisitClick:i,canViewGPS:a,getEffectivenessColor:r,getOrderStatusColor:n,getStatusLabel:l,getEffectivenessLabel:c}=e;return s?(0,o.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),(0,o.jsx)("p",{children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a..."})]})}):0===t.length?(0,o.jsxs)("div",{className:"text-center py-12",children:[(0,o.jsx)("div",{className:"text-6xl mb-4",children:"\ud83c\udfe5"}),(0,o.jsx)("h3",{className:"text-xl font-bold mb-2",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0632\u064a\u0627\u0631\u0627\u062a"}),(0,o.jsx)("p",{className:"text-gray-600",children:"\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0632\u064a\u0627\u0631\u0627\u062a \u0645\u0637\u0627\u0628\u0642\u0629 \u0644\u0644\u0628\u062d\u062b"})]}):(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((e=>(0,o.jsxs)("div",{onClick:()=>i(e),className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-300 hover:scale-105 hover:shadow-xl cursor-pointer",children:[(0,o.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("h3",{className:"font-bold text-lg text-white mb-1",children:e.clinic_name}),(0,o.jsx)("p",{className:"text-white/70 text-sm mb-2",children:e.doctor_name}),(0,o.jsxs)("p",{className:"text-white/60 text-xs",children:["\u0628\u0648\u0627\u0633\u0637\u0629: ",e.medical_rep_name]})]}),a&&e.location&&(0,o.jsx)("div",{className:"text-green-400 text-lg",title:"\u0627\u0644\u0645\u0648\u0642\u0639 \u0645\u062a\u0627\u062d",children:"\ud83d\udccd"})]}),(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 text-white/80 text-sm",children:[(0,o.jsx)("span",{children:"\ud83d\udcc5"}),(0,o.jsxs)("span",{children:[new Date(e.visit_date).toLocaleDateString("ar-EG")," -",new Date(e.visit_date).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})]})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-white/70 text-sm",children:"\u0627\u0644\u0641\u0639\u0627\u0644\u064a\u0629:"}),(0,o.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(r(e.visit_effectiveness)),children:c(e.visit_effectiveness)})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-white/70 text-sm",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0637\u0644\u0628:"}),(0,o.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(n(e.order_status)),children:l(e.order_status)})]}),e.managers_notified&&e.managers_notified.length>0&&(0,o.jsxs)("div",{className:"flex items-start gap-2",children:[(0,o.jsx)("span",{className:"text-white/70 text-sm",children:"\u0627\u0644\u0645\u062f\u0631\u0627\u0621:"}),(0,o.jsxs)("div",{className:"flex-1",children:[e.managers_notified.slice(0,2).map(((e,t)=>(0,o.jsx)("span",{className:"text-blue-300 text-xs bg-blue-500/20 px-2 py-1 rounded mr-1",children:e},t))),e.managers_notified.length>2&&(0,o.jsxs)("span",{className:"text-white/60 text-xs",children:["+",e.managers_notified.length-2]})]})]}),e.products_discussed&&e.products_discussed.length>0&&(0,o.jsxs)("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[(0,o.jsx)("span",{children:"\ud83d\udc8a"}),(0,o.jsxs)("span",{children:[e.products_discussed.length," \u0645\u0646\u062a\u062c \u062a\u0645 \u0645\u0646\u0627\u0642\u0634\u062a\u0647"]})]})]}),e.visit_notes&&(0,o.jsx)("div",{className:"mt-4 pt-4 border-t border-white/10",children:(0,o.jsx)("p",{className:"text-white/60 text-sm line-clamp-2",children:e.visit_notes})})]},e.id)))})},x=e=>{let{loginLogs:t,loading:s,canViewGPS:i}=e;return s?(0,o.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),(0,o.jsx)("p",{children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0633\u062c\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644..."})]})}):(0,o.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[(0,o.jsxs)("h3",{className:"text-xl font-bold text-white mb-6 flex items-center gap-2",children:[(0,o.jsx)("span",{children:"\ud83d\udd10"}),"\u0633\u062c\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644"]}),(0,o.jsx)("div",{className:"space-y-4",children:t.map((e=>(0,o.jsx)("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"font-medium text-white",children:e.user_name}),(0,o.jsx)("div",{className:"text-white/60 text-sm",children:e.user_role}),(0,o.jsx)("div",{className:"text-white/70 text-sm",children:new Date(e.login_time).toLocaleString("ar-EG")})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"text-white/70 text-sm",children:["IP: ",e.ip_address]}),(0,o.jsx)("div",{className:"text-white/70 text-sm",children:e.device_type}),(0,o.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,o.jsxs)("span",{className:"px-2 py-1 rounded text-xs ".concat("verified"===e.biometric_status?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"),children:["\ud83d\udcf1 ","verified"===e.biometric_status?"\u062a\u0645 \u0627\u0644\u062a\u062d\u0642\u0642 \u0627\u0644\u0628\u064a\u0648\u0645\u062a\u0631\u064a":"\u0644\u0627 \u064a\u0648\u062c\u062f \u062a\u062d\u0642\u0642 \u0628\u064a\u0648\u0645\u062a\u0631\u064a"]})})]}),(0,o.jsxs)("div",{children:[i&&e.location?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"text-white/70 text-sm flex items-center gap-1",children:[(0,o.jsx)("span",{children:"\ud83d\udccd"}),e.location.address]}),(0,o.jsxs)("div",{className:"text-white/60 text-xs",children:[e.location.latitude.toFixed(4),", ",e.location.longitude.toFixed(4)]})]}):(0,o.jsx)("div",{className:"text-white/50 text-sm",children:"\u0627\u0644\u0645\u0648\u0642\u0639 \u0645\u062d\u062c\u0648\u0628"}),(0,o.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,o.jsxs)("span",{className:"px-2 py-1 rounded text-xs ".concat("captured"===e.selfie_status?"bg-blue-500/20 text-blue-300":"bg-gray-500/20 text-gray-300"),children:["\ud83d\udcf8 ","captured"===e.selfie_status?"\u062a\u0645 \u0627\u0644\u062a\u0642\u0627\u0637 \u0635\u0648\u0631\u0629 \u0634\u062e\u0635\u064a\u0629":"\u0644\u0627 \u062a\u0648\u062c\u062f \u0635\u0648\u0631\u0629 \u0634\u062e\u0635\u064a\u0629"]})})]})]})},e.id)))})]})},m=e=>{let{visit:t,onClose:s,canViewGPS:i,getEffectivenessColor:a,getOrderStatusColor:r,getStatusLabel:n,getEffectivenessLabel:l}=e;return(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,o.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-white/20",children:(0,o.jsxs)("div",{className:"p-6",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center",children:(0,o.jsx)("span",{className:"text-2xl text-white",children:"\ud83c\udfe5"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{className:"text-2xl font-bold text-white",children:t.clinic_name}),(0,o.jsx)("p",{className:"text-white/70",children:t.doctor_name})]})]}),(0,o.jsx)("button",{onClick:s,className:"text-white/70 hover:text-white text-2xl",children:"\u2715"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,o.jsxs)("div",{className:"bg-white/5 rounded-lg p-6",children:[(0,o.jsxs)("h3",{className:"font-bold text-lg text-white mb-4 flex items-center gap-2",children:[(0,o.jsx)("span",{children:"\ud83d\udccb"}),"\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0632\u064a\u0627\u0631\u0629"]}),(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u0627\u0644\u0645\u0646\u062f\u0648\u0628:"}),(0,o.jsx)("span",{className:"text-white font-medium",children:t.medical_rep_name})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e:"}),(0,o.jsx)("span",{className:"text-white",children:new Date(t.visit_date).toLocaleDateString("ar-EG")})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u0627\u0644\u0648\u0642\u062a:"}),(0,o.jsx)("span",{className:"text-white",children:new Date(t.visit_date).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u0627\u0644\u0641\u0639\u0627\u0644\u064a\u0629:"}),(0,o.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(a(t.visit_effectiveness)),children:l(t.visit_effectiveness)})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0637\u0644\u0628:"}),(0,o.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(r(t.order_status)),children:n(t.order_status)})]})]})]}),(0,o.jsxs)("div",{className:"bg-white/5 rounded-lg p-6",children:[(0,o.jsxs)("h3",{className:"font-bold text-lg text-white mb-4 flex items-center gap-2",children:[(0,o.jsx)("span",{children:"\ud83d\udccd"}),"\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0645\u0648\u0642\u0639"]}),i&&t.location?(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u0627\u0644\u0639\u0646\u0648\u0627\u0646:"}),(0,o.jsx)("span",{className:"text-white text-sm",children:t.location.address})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u062e\u0637 \u0627\u0644\u0639\u0631\u0636:"}),(0,o.jsx)("span",{className:"text-white font-mono text-sm",children:t.location.latitude})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-white/70",children:"\u062e\u0637 \u0627\u0644\u0637\u0648\u0644:"}),(0,o.jsx)("span",{className:"text-white font-mono text-sm",children:t.location.longitude})]}),(0,o.jsx)("div",{className:"pt-3",children:(0,o.jsxs)("a",{href:"https://maps.google.com/?q=".concat(t.location.latitude,",").concat(t.location.longitude),target:"_blank",rel:"noopener noreferrer",className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm flex items-center gap-2 w-full justify-center",children:[(0,o.jsx)("span",{children:"\ud83d\uddfa\ufe0f"}),"\u0639\u0631\u0636 \u0639\u0644\u0649 \u0627\u0644\u062e\u0631\u064a\u0637\u0629"]})})]}):(0,o.jsxs)("div",{className:"text-center text-white/50 py-8",children:[(0,o.jsx)("span",{className:"text-4xl block mb-2",children:"\ud83d\udd12"}),i?"\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0645\u0648\u0642\u0639 \u063a\u064a\u0631 \u0645\u062a\u0627\u062d\u0629":"\u063a\u064a\u0631 \u0645\u0635\u0631\u062d \u0644\u0643 \u0628\u0639\u0631\u0636 \u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0645\u0648\u0642\u0639"]})]})]}),(0,o.jsxs)("div",{className:"space-y-6",children:[t.managers_notified&&t.managers_notified.length>0&&(0,o.jsxs)("div",{className:"bg-white/5 rounded-lg p-6",children:[(0,o.jsxs)("h3",{className:"font-bold text-lg text-white mb-4 flex items-center gap-2",children:[(0,o.jsx)("span",{children:"\ud83d\udc54"}),"\u0627\u0644\u0645\u062f\u0631\u0627\u0621 \u0627\u0644\u0645\u0628\u0644\u063a\u064a\u0646"]}),(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:t.managers_notified.map(((e,t)=>(0,o.jsx)("span",{className:"bg-blue-500/20 text-blue-300 px-3 py-1 rounded-full text-sm border border-blue-500/30",children:e},t)))})]}),t.products_discussed&&t.products_discussed.length>0&&(0,o.jsxs)("div",{className:"bg-white/5 rounded-lg p-6",children:[(0,o.jsxs)("h3",{className:"font-bold text-lg text-white mb-4 flex items-center gap-2",children:[(0,o.jsx)("span",{children:"\ud83d\udc8a"}),"\u0627\u0644\u0645\u0646\u062a\u062c\u0627\u062a \u0627\u0644\u0645\u0646\u0627\u0642\u0634\u0629"]}),(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:t.products_discussed.map(((e,t)=>(0,o.jsx)("span",{className:"bg-purple-500/20 text-purple-300 px-3 py-1 rounded-full text-sm border border-purple-500/30",children:e},t)))})]}),t.visit_notes&&(0,o.jsxs)("div",{className:"bg-white/5 rounded-lg p-6",children:[(0,o.jsxs)("h3",{className:"font-bold text-lg text-white mb-4 flex items-center gap-2",children:[(0,o.jsx)("span",{children:"\ud83d\udcdd"}),"\u0645\u0644\u0627\u062d\u0638\u0627\u062a \u0627\u0644\u0632\u064a\u0627\u0631\u0629"]}),(0,o.jsx)("p",{className:"text-white/80 leading-relaxed",children:t.visit_notes})]})]}),(0,o.jsx)("div",{className:"flex justify-end pt-6",children:(0,o.jsx)("button",{onClick:s,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"\u0625\u063a\u0644\u0627\u0642"})})]})})})},g=e=>{let{user:t,language:s,isRTL:n}=e;const[g,u]=(0,i.useState)("visits"),[h,p]=(0,i.useState)([]),[v,f]=(0,i.useState)([]),[b,w]=(0,i.useState)(!0),[j,_]=(0,i.useState)(!1),[y,N]=(0,i.useState)(null),[S,k]=(0,i.useState)(!1),[A,C]=(0,i.useState)(""),[P,E]=(0,i.useState)("all"),[I,L]=(0,i.useState)(""),{t:T}=(0,a.Bd)(s),D="https://6fc37004-de78-473a-b926-f0438820a235.preview.emergentagent.com/api",O=["admin","gm"].includes(null===t||void 0===t?void 0:t.role),B=["admin","gm","district_manager","manager"].includes(null===t||void 0===t?void 0:t.role);(0,i.useEffect)((()=>{z(),B&&F(),r.a.logSystemAccess("\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a",{previousSection:sessionStorage.getItem("previousSection")||"",accessMethod:"navigation",userRole:null===t||void 0===t?void 0:t.role,canViewGPS:O}),sessionStorage.setItem("previousSection","\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a")}),[]);const z=async()=>{try{w(!0);const e=localStorage.getItem("access_token");let s="".concat(D,"/visits");B||(s+="?rep_id=".concat(t.id));const i=await l.A.get(s,{headers:{Authorization:"Bearer ".concat(e)}});p(i.data||[])}catch(e){console.error("Error fetching visits:",e),p([{id:"visit-001",clinic_name:"\u0639\u064a\u0627\u062f\u0629 \u0627\u0644\u062f\u0643\u062a\u0648\u0631 \u0623\u062d\u0645\u062f \u0645\u062d\u0645\u062f",doctor_name:"\u062f. \u0623\u062d\u0645\u062f \u0645\u062d\u0645\u062f \u0639\u0644\u064a",medical_rep_name:"\u0645\u062d\u0645\u062f \u0627\u0644\u0645\u0646\u062f\u0648\u0628",visit_date:"2024-01-15T10:30:00Z",visit_effectiveness:"excellent",order_status:"ordered",location:{latitude:30.0444,longitude:31.2357,address:"\u0627\u0644\u0645\u0646\u0635\u0648\u0631\u0629\u060c \u0645\u0635\u0631"},managers_notified:["\u0623\u062d\u0645\u062f \u0627\u0644\u0645\u062f\u064a\u0631","\u0633\u0627\u0631\u0629 \u0645\u062f\u064a\u0631\u0629 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a"],products_discussed:["\u0623\u0645\u0648\u0643\u0633\u064a\u0633\u064a\u0644\u064a\u0646 500mg","\u0641\u064a\u062a\u0627\u0645\u064a\u0646 \u062f3"],visit_notes:"\u0632\u064a\u0627\u0631\u0629 \u0646\u0627\u062c\u062d\u0629 \u0645\u0639 \u0637\u0644\u0628 \u0645\u0646\u062a\u062c\u0627\u062a \u062c\u062f\u064a\u062f\u0629",status:"completed"},{id:"visit-002",clinic_name:"\u0645\u0631\u0643\u0632 \u0627\u0644\u0646\u064a\u0644 \u0627\u0644\u0637\u0628\u064a",doctor_name:"\u062f. \u0641\u0627\u0637\u0645\u0629 \u0633\u0639\u062f",medical_rep_name:"\u0623\u062d\u0645\u062f \u0627\u0644\u0645\u0646\u062f\u0648\u0628",visit_date:"2024-01-14T14:15:00Z",visit_effectiveness:"good",order_status:"interested",location:{latitude:30.0626,longitude:31.2497,address:"\u0627\u0644\u0642\u0627\u0647\u0631\u0629\u060c \u0645\u0635\u0631"},managers_notified:["\u0623\u062d\u0645\u062f \u0627\u0644\u0645\u062f\u064a\u0631"],products_discussed:["\u0623\u0646\u0633\u0648\u0644\u064a\u0646 \u0637\u0648\u064a\u0644 \u0627\u0644\u0645\u0641\u0639\u0648\u0644"],visit_notes:"\u0627\u0644\u0637\u0628\u064a\u0628 \u0645\u0647\u062a\u0645 \u0648\u0644\u0643\u0646 \u064a\u062d\u062a\u0627\u062c \u0648\u0642\u062a \u0644\u0644\u0642\u0631\u0627\u0631",status:"completed"}])}finally{w(!1)}},F=async()=>{try{const e=localStorage.getItem("access_token"),t=await l.A.get("".concat(D,"/login-logs"),{headers:{Authorization:"Bearer ".concat(e)}});f(t.data||[])}catch(e){console.error("Error fetching login logs:",e),f([{id:"log-001",user_name:"\u0645\u062d\u0645\u062f \u0627\u0644\u0645\u0646\u062f\u0648\u0628",user_role:"medical_rep",login_time:"2024-01-15T08:30:00Z",ip_address:"192.168.1.100",device_type:"Mobile - Android",location:{latitude:30.0444,longitude:31.2357,address:"\u0627\u0644\u0645\u0646\u0635\u0648\u0631\u0629\u060c \u0645\u0635\u0631"},biometric_status:"verified",selfie_status:"captured"}])}},G=e=>({excellent:"bg-green-500/20 text-green-300 border-green-500/30",very_good:"bg-lime-500/20 text-lime-300 border-lime-500/30",good:"bg-blue-500/20 text-blue-300 border-blue-500/30",average:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",poor:"bg-red-500/20 text-red-300 border-red-500/30"}[e]||"bg-gray-500/20 text-gray-300 border-gray-500/30"),V=e=>({ordered:"bg-green-500/20 text-green-300",interested:"bg-blue-500/20 text-blue-300",considering:"bg-yellow-500/20 text-yellow-300",no_order:"bg-red-500/20 text-red-300",follow_up:"bg-purple-500/20 text-purple-300"}[e]||"bg-gray-500/20 text-gray-300"),W=e=>({ordered:"\u062a\u0645 \u0627\u0644\u0637\u0644\u0628",interested:"\u0645\u0647\u062a\u0645",considering:"\u062a\u062d\u062a \u0627\u0644\u062f\u0631\u0627\u0633\u0629",no_order:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0637\u0644\u0628",follow_up:"\u0645\u062a\u0627\u0628\u0639\u0629 \u0644\u0627\u062d\u0642\u0629"}[e]||e),M=e=>({excellent:"\u0645\u0645\u062a\u0627\u0632\u0629",very_good:"\u062c\u064a\u062f\u0629 \u062c\u062f\u0627\u064b",good:"\u062c\u064a\u062f\u0629",average:"\u0645\u062a\u0648\u0633\u0637\u0629",poor:"\u0636\u0639\u064a\u0641\u0629"}[e]||e),R=h.filter((e=>{var t,s,i,a;const r=(null===(t=e.clinic_name)||void 0===t?void 0:t.toLowerCase().includes(A.toLowerCase()))||(null===(s=e.doctor_name)||void 0===s?void 0:s.toLowerCase().includes(A.toLowerCase()))||(null===(i=e.medical_rep_name)||void 0===i?void 0:i.toLowerCase().includes(A.toLowerCase())),n="all"===P||e.order_status===P,l=!I||(null===(a=e.visit_date)||void 0===a?void 0:a.split("T")[0])===I;return r&&n&&l}));return(0,o.jsxs)("div",{className:"visit-management-container",children:[(0,o.jsx)("div",{className:"mb-8",children:(0,o.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center",children:(0,o.jsx)("span",{className:"text-2xl text-white",children:"\ud83c\udfe5"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-3xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a"}),(0,o.jsx)("p",{className:"text-lg opacity-75",children:"\u0645\u062a\u0627\u0628\u0639\u0629 \u0632\u064a\u0627\u0631\u0627\u062a \u0627\u0644\u0645\u0646\u062f\u0648\u0628\u064a\u0646 \u0627\u0644\u0637\u0628\u064a\u064a\u0646 \u0644\u0644\u0639\u064a\u0627\u062f\u0627\u062a"})]})]}),(0,o.jsx)("div",{className:"flex gap-3",children:"medical_rep"===(null===t||void 0===t?void 0:t.role)&&(0,o.jsxs)("button",{onClick:()=>{_(!0)},className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 font-medium",children:[(0,o.jsx)("span",{children:"\u2795"}),"\u0632\u064a\u0627\u0631\u0629 \u062c\u062f\u064a\u062f\u0629"]})})]})}),(0,o.jsx)("div",{className:"mb-6",children:(0,o.jsxs)("div",{className:"flex gap-1 bg-white/10 backdrop-blur-lg rounded-lg p-1 border border-white/20",children:[(0,o.jsx)("button",{onClick:()=>u("visits"),className:"px-6 py-3 rounded-lg font-medium transition-colors ".concat("visits"===g?"bg-green-600 text-white":"text-white/70 hover:text-white hover:bg-white/10"),children:"\ud83d\udccb \u0633\u062c\u0644 \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a"}),B&&(0,o.jsx)("button",{onClick:()=>u("login-logs"),className:"px-6 py-3 rounded-lg font-medium transition-colors ".concat("login-logs"===g?"bg-green-600 text-white":"text-white/70 hover:text-white hover:bg-white/10"),children:"\ud83d\udd10 \u0633\u062c\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644"})]})}),"visits"===g&&(0,o.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{type:"text",placeholder:"\u0627\u0644\u0628\u062d\u062b \u0641\u064a \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a...",value:A,onChange:e=>C(e.target.value),className:"w-full px-4 py-3 pl-12 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white"}),(0,o.jsx)("span",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\ud83d\udd0d"})]}),(0,o.jsxs)("select",{value:P,onChange:e=>E(e.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white",children:[(0,o.jsx)("option",{value:"all",className:"text-black",children:"\u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0627\u0644\u0627\u062a"}),(0,o.jsx)("option",{value:"ordered",className:"text-black",children:"\u062a\u0645 \u0627\u0644\u0637\u0644\u0628"}),(0,o.jsx)("option",{value:"interested",className:"text-black",children:"\u0645\u0647\u062a\u0645"}),(0,o.jsx)("option",{value:"considering",className:"text-black",children:"\u062a\u062d\u062a \u0627\u0644\u062f\u0631\u0627\u0633\u0629"}),(0,o.jsx)("option",{value:"no_order",className:"text-black",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0637\u0644\u0628"}),(0,o.jsx)("option",{value:"follow_up",className:"text-black",children:"\u0645\u062a\u0627\u0628\u0639\u0629 \u0644\u0627\u062d\u0642\u0629"})]}),(0,o.jsx)("input",{type:"date",value:I,onChange:e=>L(e.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white"})]}),"visits"===g&&(0,o.jsx)(d,{visits:R,loading:b,onVisitClick:e=>{N(e),k(!0)},canViewGPS:O,getEffectivenessColor:G,getOrderStatusColor:V,getStatusLabel:W,getEffectivenessLabel:M}),"login-logs"===g&&B&&(0,o.jsx)(x,{loginLogs:v,loading:b,canViewGPS:O}),j&&(0,o.jsx)(c,{user:t,language:s,isRTL:n,onClose:()=>_(!1),onSave:e=>{p((t=>[e,...t])),z()}}),S&&y&&(0,o.jsx)(m,{visit:y,onClose:()=>k(!1),canViewGPS:O,getEffectivenessColor:G,getOrderStatusColor:V,getStatusLabel:W,getEffectivenessLabel:M})]})}},269:(e,t,s)=>{s.d(t,{a:()=>r});var i=s(555),a=s(722);const r=new class{constructor(){this.API="https://6fc37004-de78-473a-b926-f0438820a235.preview.emergentagent.com/api",this.isEnabled=!0,this.currentPosition=null,this.retryQueue=[]}async getCurrentPosition(){if(!navigator.geolocation)return console.warn("Geolocation is not supported"),null;try{const t=await new Promise(((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5})}));this.currentPosition={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,altitude:t.coords.altitude,speed:t.coords.speed,heading:t.coords.heading,timestamp:(new Date).toISOString()};try{const e=await this.getAddressFromCoordinates(t.coords.latitude,t.coords.longitude);this.currentPosition.address=e.formatted_address,this.currentPosition.city=e.city,this.currentPosition.area=e.area,this.currentPosition.country=e.country}catch(e){console.warn("Failed to get address from coordinates:",e),this.currentPosition.address="".concat(t.coords.latitude.toFixed(4),", ").concat(t.coords.longitude.toFixed(4))}return this.currentPosition}catch(e){return console.warn("Failed to get current position:",e),null}}async getAddressFromCoordinates(e,t){const s="AIzaSyDzxZjDxPdcrnGKb66mT5BIvQzQWcnLp70";try{const i=await fetch("https://maps.googleapis.com/maps/api/geocode/json?latlng=".concat(e,",").concat(t,"&key=").concat(s,"&language=ar")),a=await i.json();if(a.results&&a.results.length>0){const e=a.results[0];return{formatted_address:e.formatted_address,city:this.extractAddressComponent(e,"locality")||this.extractAddressComponent(e,"administrative_area_level_2"),area:this.extractAddressComponent(e,"administrative_area_level_3")||this.extractAddressComponent(e,"sublocality"),country:this.extractAddressComponent(e,"country")||"\u0645\u0635\u0631"}}}catch(i){console.warn("Geocoding failed:",i)}return{formatted_address:"".concat(e.toFixed(4),", ").concat(t.toFixed(4)),city:"",area:"",country:"\u0645\u0635\u0631"}}extractAddressComponent(e,t){const s=e.address_components.find((e=>e.types.includes(t)));return s?s.long_name:""}getDeviceInfo(){const e=navigator.userAgent;return{device_type:this.getDeviceType(),operating_system:this.getOperatingSystem(),browser:this.getBrowserInfo(),browser_version:this.getBrowserVersion(),user_agent:e,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height),viewport_size:"".concat(window.innerWidth,"x").concat(window.innerHeight),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,online:navigator.onLine}}getDeviceType(){const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"}getOperatingSystem(){const e=navigator.userAgent,t=[{name:"Windows 11",regex:/Windows NT 10\.0.*rv:91/},{name:"Windows 10",regex:/Windows NT 10\.0/},{name:"Windows 8.1",regex:/Windows NT 6\.3/},{name:"Windows 8",regex:/Windows NT 6\.2/},{name:"Windows 7",regex:/Windows NT 6\.1/},{name:"macOS",regex:/Mac OS X/},{name:"iOS",regex:/(iPhone|iPad|iPod)/},{name:"Android",regex:/Android/},{name:"Linux",regex:/Linux/},{name:"Unix",regex:/X11/}];for(const s of t)if(s.regex.test(e))return s.name;return"Unknown"}getBrowserInfo(){const e=navigator.userAgent,t=[{name:"Chrome",regex:/Chrome/},{name:"Firefox",regex:/Firefox/},{name:"Safari",regex:/Safari/},{name:"Edge",regex:/Edge/},{name:"Opera",regex:/Opera/},{name:"Internet Explorer",regex:/MSIE/}];for(const s of t)if(s.regex.test(e))return s.name;return"Unknown"}getBrowserVersion(){const e=navigator.userAgent.match(/(Chrome|Firefox|Safari|Edge|Opera)\/(\d+\.\d+)/);return e?e[2]:"Unknown"}async logActivity(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(this.isEnabled)try{var o;const c=localStorage.getItem("access_token");if(!c)return void console.warn("No access token available for activity logging");const d={type:e,action:t,target_type:s,target_id:r,target_name:n,location:await this.getCurrentPosition(),device_info:this.getDeviceInfo(),details:(0,i.A)((0,i.A)({},l),{},{page_url:window.location.href,page_title:document.title,referrer:document.referrer,session_storage_length:sessionStorage.length,local_storage_length:localStorage.length}),metadata:{logged_at:(new Date).toISOString(),user_agent:navigator.userAgent,connection_type:(null===(o=navigator.connection)||void 0===o?void 0:o.effectiveType)||"unknown",battery_level:navigator.getBattery?await navigator.getBattery().then((e=>e.level)):null}},x=await a.A.post("".concat(this.API,"/activities"),d,{headers:{Authorization:"Bearer ".concat(c),"Content-Type":"application/json"},timeout:1e4});return console.log("Activity logged successfully:",x.data),x.data}catch(c){console.error("Failed to log activity:",c),this.retryQueue.push({type:e,action:t,targetType:s,targetId:r,targetName:n,details:l,timestamp:(new Date).toISOString(),retryCount:0}),this.scheduleRetry()}}scheduleRetry(){0!==this.retryQueue.length&&setTimeout((async()=>{const e=this.retryQueue.shift();if(e&&e.retryCount<3){e.retryCount++;try{await this.logActivity(e.type,e.action,e.targetType,e.targetId,e.targetName,e.details)}catch(t){e.retryCount<3&&this.retryQueue.push(e)}}}),5e3)}async logVisitRegistration(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.logActivity("visit_registration","\u062a\u0633\u062c\u064a\u0644 \u0632\u064a\u0627\u0631\u0629 \u0639\u064a\u0627\u062f\u0629","clinic",e,t,(0,i.A)({visit_duration:s.duration||null,doctor_present:s.doctorPresent||null,samples_given:s.samplesGiven||0,notes:s.notes||"",visit_type:s.type||"routine"},s))}async logClinicRegistration(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.logActivity("clinic_registration","\u062a\u0633\u062c\u064a\u0644 \u0639\u064a\u0627\u062f\u0629 \u062c\u062f\u064a\u062f\u0629","clinic",e,t,(0,i.A)({doctor_name:s.doctorName||"",specialty:s.specialty||"",classification:s.classification||"",phone:s.phone||"",address:s.address||""},s))}async logOrderCreation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.logActivity("order_creation","\u0625\u0646\u0634\u0627\u0621 \u0637\u0644\u0628 \u062c\u062f\u064a\u062f","order",e,"\u0637\u0644\u0628 \u0631\u0642\u0645 ".concat(e),(0,i.A)({order_value:t.totalValue||0,items_count:t.itemsCount||0,clinic_name:t.clinicName||"",payment_method:t.paymentMethod||""},t))}async logProductUpdate(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.logActivity("product_update","\u062a\u062d\u062f\u064a\u062b \u0645\u0646\u062a\u062c","product",e,t,(0,i.A)({old_price:s.oldPrice||null,new_price:s.newPrice||null,change_reason:s.changeReason||"",update_type:s.updateType||"general"},s))}async logUserCreation(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.logActivity("user_creation","\u0625\u0646\u0634\u0627\u0621 \u0645\u0633\u062a\u062e\u062f\u0645 \u062c\u062f\u064a\u062f","user",e,t,(0,i.A)({user_role:s.role||"",department:s.department||"",permissions:s.permissions||[]},s))}async logSystemAccess(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.logActivity("system_access","\u062f\u062e\u0648\u0644 \u0642\u0633\u0645 ".concat(e),"system",e,"\u0642\u0633\u0645 ".concat(e),(0,i.A)({access_time:(new Date).toISOString(),previous_section:t.previousSection||"",access_method:t.accessMethod||"navigation"},t))}async logLogin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.logActivity("login","\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644","system","login","\u0646\u0638\u0627\u0645 EP Group",(0,i.A)({login_method:e.method||"password",biometric_verified:e.biometricVerified||!1,failed_attempts:e.failedAttempts||0,remember_me:e.rememberMe||!1},e))}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}clearRetryQueue(){this.retryQueue=[]}}}}]);
//# sourceMappingURL=694.33ac7126.chunk.js.map